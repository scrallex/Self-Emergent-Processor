<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEP Dynamics - Interactive Demos</title>
    <meta name="description"
        content="Interactive demonstrations of SEP Dynamics concepts including quantum coherence, prime patterns, and emergent behaviors">
    
    <!-- Main and Demo Styles -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/demos.css">

    <!-- Demo-specific Styles -->
</head>
<body class="demo-hub">
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="stat-value">SEP</div>
    </div>

    <!-- Demo Navigation -->
    <nav class="demo-nav">
        <h1>SEP Dynamics Interactive Demos</h1>
        <div class="nav-controls">
            <button id="hubBtn" class="btn btn-secondary">Demo Hub</button>
            <button id="controlsBtn" class="btn btn-secondary">Toggle Controls</button>
            <button id="videoBtn" class="btn btn-video">Video Mode</button>
            <a href="index.html" class="btn btn-secondary">Back to Main Site</a>
        </div>
    </nav>

    <!-- Demo Grid -->
    <div class="demo-grid" id="demoGrid"></div>

    <!-- Demo Container -->
    <div class="demo-container" id="demoContainer">
        <canvas id="demo-canvas"></canvas>
    </div>

    <!-- Control Panel -->
    <div class="control-panel hidden" id="controlPanel">
        <h3>Demo Controls</h3>
        
        <div class="control-group">
            <label>Quality</label>
            <select id="qualitySelect" class="btn btn-secondary" style="width:100%;">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
            </select>
        </div>

        <div class="control-group">
            <label for="speedSlider">Speed: <span id="speedValue">1.0x</span></label>
            <input type="range" id="speedSlider" min="0.1" max="3" step="0.1" value="1">
        </div>

        <div class="control-group">
            <label for="intensitySlider">Intensity: <span id="intensityValue">50%</span></label>
            <input type="range" id="intensitySlider" min="0" max="100" value="50">
        </div>

        <div class="control-group">
            <label for="blockSizeSlider">Block Size: <span id="blockSizeValue">30</span></label>
            <input type="range" id="blockSizeSlider" min="10" max="60" value="30">
            <label for="sizeSlider">Particle Size: <span id="sizeValue">3</span></label>
            <input type="range" id="sizeSlider" min="1" max="10" value="3">
        </div>

        <div class="control-group">
            <label>Preset</label>
            <select id="presetSelect" class="btn btn-secondary" style="width:100%;">
                <option value="default">Default</option>
                <option value="intro">Introduction</option>
                <option value="demo">Demonstration</option>
                <option value="climax">Climax</option>
                <option value="outro">Outro</option>
            </select>
        </div>

        <div class="control-group">
            <button id="resetBtn" class="btn">Reset to Default</button>
            <button id="exportBtn" class="btn">Export Frame</button>
        </div>

        <div class="control-group">
            <label>FPS: <span id="fpsCounter">--</span></label>
        </div>
    </div>

    <!-- Demo Framework Script -->
    <script type="module">
        import demoFramework from './assets/js/demos/enhanced-framework.js';

    // DOM Elements
    const loadingScreen = document.getElementById('loadingScreen');
    const demoGrid = document.getElementById('demoGrid');
    const demoContainer = document.getElementById('demoContainer');
    const controlPanel = document.getElementById('controlPanel');
        
            // --- Framework Initialization ---
        let framework = null;
        
        async function initFramework() {
            framework = demoFramework;
            await framework.init('demo-canvas');
        }
        
            const showLoading = () => loadingScreen.classList.add('active');
            const hideLoading = () => loadingScreen.classList.remove('active');

            // --- Demo Loading and Navigation ---
            async function loadDemo(sceneId) {
            showLoading();
            demoGrid.style.display = 'none';
            demoContainer.classList.add('active');
            controlPanel.classList.remove('hidden');
            
            try {
                if (!framework) await initFramework();
                await framework.loadScene(sceneId);
                document.getElementById('blockSizeSlider').value = framework.settings.blockSize || 30;
                updateBlockSize();
            } catch (error) {
                console.error('Failed to load demo:', error);
                backToHub();
            } finally {
                hideLoading();
            }
        }

            function backToHub() {
                if (framework) framework.unloadCurrentScene();
                demoContainer.classList.remove('active');
                demoGrid.style.display = 'grid';
                controlPanel.classList.add('hidden');
        }

            // --- UI Controls ---
            function updateQuality() {
            const quality = document.getElementById('qualitySelect').value;
            if (framework) framework.updateSettings({ quality });
        }

            function updateSpeed() {
            const speed = parseFloat(document.getElementById('speedSlider').value);
            document.getElementById('speedValue').textContent = speed.toFixed(1) + 'x';
            if (framework) framework.updateSettings({ speed });
        }

        function updateIntensity() {
            const intensity = parseInt(document.getElementById('intensitySlider').value);
            document.getElementById('intensityValue').textContent = intensity + '%';
            if (framework) framework.updateSettings({ intensity });
        }

            function updateBlockSize() {
                const blockSize = parseInt(document.getElementById('blockSizeSlider').value);
                document.getElementById('blockSizeValue').textContent = blockSize;
                if (framework) framework.updateSettings({ blockSize });
            }
            
            function updateSize() {
                const size = parseInt(document.getElementById('sizeSlider').value);
                document.getElementById('sizeValue').textContent = size;
                if (framework) framework.updateSettings({ size });
            }

            function applyPreset() {
            const presetName = document.getElementById('presetSelect').value;
            if (framework && framework.applyPreset(presetName)) {
                // Sync UI sliders with preset values
                const settings = framework.settings;
                document.getElementById('speedSlider').value = settings.speed;
                document.getElementById('intensitySlider').value = settings.intensity;
                document.getElementById('blockSizeSlider').value = settings.blockSize || 30;
                updateSpeed();
                updateIntensity();
                updateBlockSize();
                document.getElementById('sizeSlider').value = settings.size;
                updateSpeed();
                updateIntensity();
                updateSize();
            }
        }

            function resetToDefault() {
            document.getElementById('presetSelect').value = 'default';
            applyPreset();
        }

            function exportFrame() {
            if (framework) {
                const dataUrl = framework.exportFrame();
                if (dataUrl) {
                    const link = document.createElement('a');
                    link.download = `sep-demo-${framework.currentScene}-${Date.now()}.png`;
                    link.href = dataUrl;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            }
        }

            // --- FPS Counter ---
        let lastTime = performance.now();
            let frames = 0;
            function updateFPS() {
                const currentTime = performance.now();
                const deltaTime = currentTime - lastTime;
                frames++;
                
                if (deltaTime >= 1000) {
                    document.getElementById('fpsCounter').textContent = frames;
                    frames = 0;
                    lastTime = currentTime;
                }
            }
            
            function animate() {
                updateFPS();
                requestAnimationFrame(animate);
            }

                // --- Dynamic Content Generation ---
                function populateDemoGrid() {
                    const scenes = framework.getAllScenes();
                    scenes.forEach(scene => {
                        const card = document.createElement('div');
                        card.className = 'demo-card';
                        if (scene.status !== 'ready') card.classList.add('disabled');
                        card.dataset.scene = scene.id;
                        card.innerHTML = `
                    <div class="demo-status ${scene.status}"></div>
                    <h3>Scene ${scene.id}: ${scene.name}</h3>
                    <p>${scene.description || 'An interactive visualization.'}</p>
                `;
                        if (scene.status === 'ready') {
                            card.addEventListener('click', () => loadDemo(scene.id));
                        }
                        demoGrid.appendChild(card);
                    });
                }


                // --- Event Listeners ---
                function setupEventListeners() {
                    document.getElementById('hubBtn').addEventListener('click', backToHub);
                    document.getElementById('controlsBtn').addEventListener('click', () => controlPanel.classList.toggle('hidden'));
                    document.getElementById('videoBtn').addEventListener('click', () => framework.toggleVideoMode());
                    document.getElementById('qualitySelect').addEventListener('change', updateQuality);
                    document.getElementById('speedSlider').addEventListener('input', updateSpeed);
                    document.getElementById('intensitySlider').addEventListener('input', updateIntensity);
                    document.getElementById('blockSizeSlider').addEventListener('input', updateBlockSize);
                    document.getElementById('sizeSlider').addEventListener('input', updateSize);
                    document.getElementById('presetSelect').addEventListener('change', applyPreset);
                    document.getElementById('resetBtn').addEventListener('click', resetToDefault);
                    document.getElementById('exportBtn').addEventListener('click', exportFrame);

                    window.addEventListener('resize', () => framework?.resizeCanvas());

                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape' && demoContainer.classList.contains('active')) backToHub();
                        else if (e.key.toLowerCase() === 'f' && framework?.currentScene) document.documentElement.requestFullscreen();
                        else if (e.key.toLowerCase() === 'v') framework?.toggleVideoMode();
                        else if (e.key.toLowerCase() === 'c') controlPanel.classList.toggle('hidden');
                    });
                }

                // --- Main Initialization ---
                async function main() {
                    showLoading();
                    await initFramework();
                    populateDemoGrid();
                    setupEventListeners();
                    hideLoading();
                    animate();
        }

            main().catch(console.error);
        </script>
    </body>
    </html>